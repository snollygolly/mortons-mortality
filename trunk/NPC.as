/*The NPC Class handles the spawning and movement of all NPCsit also has "testDrop" that determines if item drops on specific npcs should trigger dialog*/package{	import flash.display.*	import flash.events.*	import flash.utils.Timer;		public class NPC extends MovieClip	{		//the list is an array of all items on stage		static public var list:Array= [];		static public var npcFlags:Array;		static public var main;		static public var iMarker:int; //used to reference a mouseevent object against the list of objects 				static public var moveDir:String;		static public var moving:Boolean = false;		static public var movingNPC:MovieClip;		static public var cSix:int = 0; //6 count, moves every 6 frames						public function NPC(x_, y_, iType:int) //itype = npc type		{			main=this;			//add the npc to the list of all npcs			list.push(this);			gotoAndStop(iType);			x = x_;			y = y_;			npcHit.mouseEnabled=false;			npcHit.alpha=0;			hitArea=npcHit; //for collisions			if (!npcFlags){populateFlags();} //npc flags are used to track progress in the game			//add event listeners for mouse up and down			addEventListener(MouseEvent.MOUSE_DOWN, dragDropDn);			addEventListener(MouseEvent.MOUSE_UP, dragDropUp);			addEventListener(MouseEvent.ROLL_OVER, npcOver);			addEventListener(MouseEvent.ROLL_OUT, npcOut);			addEventListener(Event.ENTER_FRAME, enterFrame);		}				public function populateFlags(){ //fill all npc flags with 0's			npcFlags = new Array(new Array(8), new Array(8), new Array(8), new Array(8), new Array(8), new Array(8), new Array(8), new Array(8));			var i = 0;			var h = 0;			while (i != 8)			{				while (h != 8)				{					npcFlags[i][h] = 0; 					h++;				}				h=0;				i++;			}		}				public function dragDropDn(e:MouseEvent)		{			var object = e.target;			for(var i:int=0; i<list.length; i++) //check to see which npc was moused			{				if (object == list[i]){ //objects match					iMarker = i;					trace ("*NPC: imarker: " + iMarker);				}			}		}				public function dragDropUp(e:MouseEvent)		{			var obj = e.target;			//add in dialog start here			if (Item.isDragging == true){ //if you're dropping an item on the npc				trace ("*NPC: dragddropup: isdragging=true");				Item.main.stopItem(Item.list[Item.iMarker], e.stageY); //stop the item				Item.main.placeItems(Item.list[Item.iMarker]); //put it back in your inventory				if (Item.lastNPCType == list[iMarker].currentFrame){ //if you were currently dragging an item					if (testDrop(Item.lastItemType, Item.lastNPCType) == false){return;}  //see if the drop should trigger dialog					Item.lastNPCType = 0; //reset var				}			}			if (Tooltip.dialogOn == true || Tooltip.delay == true){Tooltip.curStep++;Tooltip.main.drawDialog(Tooltip.curNPC, Map.main.currentFrame);return;} //if dialog isn't on and we aren't fading text, start dialog			Tooltip.dialogOn = true; //otherwise, assume it's your initial click			Tooltip.curStep = 1; //set the step to 1			Tooltip.curNPC = list[iMarker].currentFrame; //store the npc type			Tooltip.main.drawDialog(Tooltip.curNPC, Map.main.currentFrame) //go go gadget dialog!		}				public function npcOver(e:MouseEvent){			var obj = e.target;			var tempTip:String;			tempTip = Tooltip.main.translateNPCs(obj.currentFrame, Map.main.currentFrame); //display tooltip on NPC (if any)			if (tempTip != "x"){Tooltip.main.displayText(tempTip);} // "x" if no tooltip		}				public function npcOut(e:MouseEvent){			Tooltip.main.clearText();		}				public function testDrop(iType:int, npcType:int){ //see if item drops should trigger dialog			switch (Map.main.currentFrame){				case 21:					if (iType == 3){return true;}				case 24:					if (iType == 6){return true;}				default:					return false;			}		}				public function findNPCs(npcType:int){ 			for(var i:int=0; i<NPC.list.length; i++) 			{					if (NPC.list[i].currentFrame == npcType){ //if specified npc matches, return true						return i;					}			}			return 0;		}				public function moveNPC(target:MovieClip, dir:String, dur:int){			movingNPC = target;			moveDir = dir;			moving = true;			var myTimer:Timer = new Timer(dur, 1);			myTimer.addEventListener(TimerEvent.TIMER, stopNPC);			myTimer.start();		}				public function enterFrame(e:Event){			if (moving == true){				var offset:int = 0;				switch (moveDir){					case "n":						movingNPC.y -= 3;						offset = 6;						break;					case "s":						movingNPC.y += 3;						offset = 9;						break;					case "w":						movingNPC.x -= 3;						offset = 3;						break;					case "e":						movingNPC.x += 3;						break;				}				if (cSix == 0){//first frame for animation					translateNPC(movingNPC.currentFrame, (offset + 1), true);					cSix = 1;					return;				}				if (cSix == 6){					cSix = 1;					trace ("*NPC: enterframe: currentFrame", (translateNPC(movingNPC.currentFrame, 0, false) - offset) , "offset", offset);					if ((translateNPC(movingNPC.currentFrame, 0, false) - offset) == 3){						translateNPC(movingNPC.currentFrame, (offset + 1), true);					}					else {						translateNPC(movingNPC.currentFrame, (translateNPC(movingNPC.currentFrame, 0, false) + 1), true);					}				}else{cSix++;}			}		}				public function stopNPC(event:TimerEvent):void{			var offset:int = 0;			switch (moveDir){				case "n":					offset = 6;					break;				case "s":					offset = 9;					break;				case "w":					offset = 3					break;			}			translateNPC(movingNPC.currentFrame, (offset + 1), true);			moving = false;			cSix = 0;		}				public function translateNPC(nType:int, nFrame:int, setFrame:Boolean)		{			switch (nType)			{				case 1:					if (setFrame == true){movingNPC.boss.gotoAndStop(nFrame);}else{return movingNPC.boss.currentFrame;}					break;				case 2:					if (setFrame == true){movingNPC.matthew.gotoAndStop(nFrame);}else{return movingNPC.matthew.currentFrame;}					break;				case 3:					if (setFrame == true){movingNPC.maria.gotoAndStop(nFrame);}else{return movingNPC.maria.currentFrame;}					break;				default:					return 0;			}		}						public function spawnNPCs(x_,y_, iType){ //mostly for use from other classes			MM.main.npc = new NPC(x_, y_, iType);			MM.main.spriteClip.addChild(MM.main.npc);		}				public function removeNPCs(){ //used to remove all items that aren't in the inventory			var i:int=0;			while(i<list.length) //check for collisions with all items			{				list[i].removeEventListener(MouseEvent.MOUSE_DOWN, dragDropDn);				list[i].removeEventListener(MouseEvent.MOUSE_UP, dragDropUp);				list[i].removeEventListener(MouseEvent.ROLL_OVER, npcOver);				list[i].removeEventListener(MouseEvent.ROLL_OUT, npcOut);				//remove my grpahic from the stage				MM.main.spriteClip.removeChild(list[i]);				list.splice(i,1);			}					}	}}